"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t,o){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e(t,o):"function"==typeof define&&define.amd?define((function(){return e(t,o)})):t.Noose=e(t,o)}((function(e,t){function o(){}var r=Math.min,n=Math.max,s={classes:{noose:"noose",selected:"selected"},compute:!0,container:"body",containers:[],ctrl:!0,detach:!0,enabled:!0,mode:"touch",move:o,scroll:10,scrollEdge:10,scrollbar:17,select:"*",shift:!0,start:o,stop:o,style:{border:"1px dotted #000",zIndex:1e3},throttle:200};return function(){function o(i,l){_classCallCheck(this,o);var c=this;if("object"!==_typeof(i)||null==i||i instanceof HTMLElement||(l=i,i=null),l=c.opts=Object.assign({},s,l),("string"==typeof i||i instanceof HTMLElement)&&(l.container=i),l.container instanceof HTMLElement)c.containers=[l.container];else{if("string"!=typeof l.container)throw new Error("Invalid container option");c.containers=Array.prototype.slice.call(t.querySelectorAll(l.container))}c.coors={pointer:{},noose:{},container:{}};var a=c.noose=t.createElement("div");a.style.position="absolute",a.style.zIndex=l.style.zIndex,a.style.border=l.style.border,l.classes.noose&&a.classList.add(l.classes.noose);var u=!1,d=!1;return c._onStart=function(t){var o=t.currentTarget===c.currentTarget;if(l.enabled&&(!u||!o)&&("mousedown"!==t.type||1===t.which)){u=!0;var s=c.currentTarget=t.currentTarget,i=c.coors.container,d=c.coors.pointer,y=c.coors.noose,p=e.getComputedStyle(s);"static"===p.position&&console.warn("Container is not a positioned element. This may cause issues positioning the noose and/or selecting elements."),l.scroll>0&&l.scrollEdge>0?(i.scrollX=("auto"===p.overflowX||"scroll"===p.overflowX)&&s.scrollHeight>s.clientHeight,i.scrollY=("auto"===p.overflowY||"scroll"===p.overflowY)&&s.scrollWidth>s.clientWidth):(i.scrollX=!1,i.scrollY=!1),i.maxScrollY=i.scrollY&&s.scrollHeight-s.clientHeight||0,i.maxScrollX=i.scrollX&&s.scrollWidth-s.clientWidth||0;var f=d.start,h=d.end;if(d.start=null,y.start=null,c.updateContainerPosition().updatePointerPosition(t),l.scrollbar&&(i.scrollX&&d.end.x>i.x+i.w-l.scrollbar||i.scrollY&&d.end.y>i.y+i.h-l.scrollbar))return u=!1,d.start=f,void(d.end=h);if(l.shift&&o&&t.shiftKey&&f){var v=y.top,m=y.bottom,x=Math.floor((f.x+h.x)/2),g=Math.floor((f.y+h.y)/2);y.start={},d.start.x>=x&&d.start.y<g?(d.start.x=r(f.x,h.x),d.start.y=n(f.y,h.y),y.start.x=v.x,y.start.y=m.y):d.start.x<x&&d.start.y<=g?(d.start.x=n(f.x,h.x),d.start.y=n(f.y,h.y),y.start=m):d.start.x<=x&&d.start.y>g?(d.start.x=n(f.x,h.x),d.start.y=r(f.y,h.y),y.start.x=m.x,y.start.y=v.y):d.start.x>x&&d.start.y>=g&&(d.start.x=r(f.x,h.x),d.start.y=r(f.y,h.y),y.start=v)}if(l.ctrl&&o&&t.ctrlKey?c.lastSelection=c.selected||[]:c.lastSelection=[],a.style.display="none",!1===l.start.apply(c,[t,c.coors]))return u=!1,d.start=f,void(d.end=h);s.appendChild(a)}},c._onMove=function(e){if(l.enabled&&u&&e.currentTarget===c.currentTarget){e.cancelable&&e.preventDefault(),"scroll"!==e.type&&c.updatePointerPosition(e),c.updateContainerPosition().updateNoosePosition();var t=c.coors.noose.top,o=c.coors.noose.bottom;a.style.left=t.x+"px",a.style.top=t.y+"px",a.style.width=o.x-t.x+"px",a.style.height=o.y-t.y+"px",a.style.display="block";var r=c.currentTarget,n=c.coors.container,s=c.coors.pointer.end;n.scrollY&&s.y-n.y<l.scrollEdge?r.scrollTop-=l.scroll:n.scrollY&&r.scrollTop<n.maxScrollY&&n.y+n.h-s.y<l.scrollEdge?r.scrollTop+=l.scroll:n.scrollX&&s.x-n.x<l.scrollEdge?r.scrollLeft-=l.scroll:n.scrollX&&r.scrollLeft<n.maxScrollX&&n.x+n.w-s.x<l.scrollEdge&&(r.scrollLeft+=l.scroll),l.compute&&(l.throttle?d||(d=!0,setTimeout((function(){d&&c.compute()&&l.move.apply(c,[e,c.coors,c.selected]),d=!1}),l.throttle)):(c.compute(),l.move.apply(c,[e,c.coors,c.selected])))}},c._onEnd=function(e){c.opts.enabled&&u&&("mouseup"!==e.type||1===e.which)&&(u=!1,e.currentTarget===c.currentTarget&&(c.updateContainerPosition().updatePointerPosition(e).updateNoosePosition(),d=!1,l.compute&&c.compute(!0),setTimeout((function(){l.stop.apply(c,[e,c.coors,c.selected])}),0),l.detach&&c.currentTarget.removeChild(a)))},c.containers.forEach((function(e){c._register(e)})),c}return _createClass(o,[{key:"destroy",value:function(){var e=this;return e.containers.forEach((function(t){e._deregister(t)})),e.noose.remove(),e.noose=null,e}},{key:"updateContainerPosition",value:function(){var t=this.coors.container,o=this.currentTarget.getBoundingClientRect();return t.x=o.left+e.pageXOffset,t.y=o.top+e.pageYOffset,t.w=o.width,t.h=o.height,this}},{key:"updatePointerPosition",value:function(e){var t=e&&e.touches&&e.touches[0]||e,o=this.coors.pointer;return t&&"number"==typeof t.pageX&&(o.end={x:t.pageX,y:t.pageY},o.start||(o.start=o.end)),this}},{key:"updateNoosePosition",value:function(){var e=this.currentTarget,t=this.coors.pointer.end,o=this.coors.container,s=this.coors.noose,i=n(t.x-o.x+e.scrollLeft,0),l=n(t.y-o.y+e.scrollTop,0);return s.start||(s.start={x:i,y:l}),s.top={x:r(s.start.x,i),y:r(s.start.y,l)},s.bottom={x:r(n(s.start.x,i),e.scrollWidth),y:r(n(s.start.y,l),e.scrollHeight)},this}},{key:"compute",value:function(){var t=this;if(t.opts.select){var o=t.opts.classes.selected,r=t.currentTarget,n=r.querySelectorAll(t.opts.select),s=t.coors.noose.top,i=t.coors.noose.bottom,l=t.coors.container.x,c=t.coors.container.y;t.selected=[],Array.prototype.forEach.call(n,(function(n){if(n!==t.noose){var a,u=n.getBoundingClientRect(),d=u.left+e.pageXOffset-l+r.scrollLeft,y=u.top+e.pageYOffset-c+r.scrollTop,p=u.width+d,f=u.height+y;a="fit"===t.opts.mode?s.x<=d&&s.y<=y&&i.x>=p&&i.y>=f:!(s.x>p||s.y>f||i.x<d||i.y<y);var h=t.lastSelection.indexOf(n);a&&-1===h||!a&&-1!==h?(o&&n.classList.add(o),t.selected.push(n)):o&&n.classList.remove(o)}}))}return t}},{key:"_deregister",value:function(e){return e.removeEventListener("mousedown",this._onStart),e.removeEventListener("touchstart",this._onStart),e.removeEventListener("mousemove",this._onMove),e.removeEventListener("touchmove",this._onMove),e.removeEventListener("scroll",this._onMove),e.removeEventListener("mouseup",this._onEnd),e.removeEventListener("touchend",this._onEnd),delete e.noose,this}},{key:"deregister",value:function(e){var t=this.containers.indexOf(e);return t>-1&&"function"==typeof e.removeEventListener&&(this._deregister(e),this.containers.splice(t,1)),this}},{key:"_register",value:function(e){return e.addEventListener("mousedown",this._onStart),e.addEventListener("touchstart",this._onStart,!1),e.addEventListener("mousemove",this._onMove),e.addEventListener("touchmove",this._onMove,!1),e.addEventListener("scroll",this._onMove),e.addEventListener("mouseup",this._onEnd),e.addEventListener("touchend",this._onEnd,!1),e.noose=this}},{key:"register",value:function(e){return-1===this.containers.indexOf(e)&&"function"==typeof e.addEventListener&&(this._register(e),this.containers.push(e)),this}}],[{key:"version",get:function(){return"1.2.2"}}]),o}()}),window,document);
//# sourceMappingURL=noose.es5.js.map
