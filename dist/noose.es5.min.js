"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t,o){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e(t,o):"function"==typeof define&&define.amd?define((function(){return e(t,o)})):t.Noose=e(t,o)}((function(e,t){function o(){}var r=Math.min,n=Math.max,s={classes:{noose:"noose",selected:"selected"},compute:!0,container:"body",ctrl:!0,enabled:!0,mode:"touch",move:o,scroll:10,scrollEdge:10,scrollbar:17,select:"*",shift:!0,start:o,stop:o,style:{border:"1px dotted #000",zIndex:1e3},throttle:200};return function(){function o(l,c){_classCallCheck(this,o);var a=this;if("object"!==_typeof(l)||null==l||l instanceof HTMLElement||(c=l,l=null),c=a.opts=Object.assign({},s,c),("string"==typeof l||l instanceof HTMLElement)&&(c.container=l),c.container instanceof HTMLElement)a.containers=[c.container];else{if("string"!=typeof c.container)throw new Error("Invalid container option");a.containers=t.querySelectorAll(c.container)}a.coors={pointer:{},noose:{},container:{}};var i=a.noose=t.createElement("div");i.style.position="absolute",i.style.zIndex=c.style.zIndex,i.style.border=c.style.border,c.classes.noose&&i.classList.add(c.classes.noose);var u=!1,d=!1;return a._onStart=function(t){var o=t.currentTarget===a.currentTarget;if(c.enabled&&(!u||!o)&&("mousedown"!==t.type||1===t.which)){u=!0;var s=a.currentTarget=t.currentTarget,l=a.coors.container,d=a.coors.pointer,y=a.coors.noose,p=e.getComputedStyle(s);"static"===p.position&&console.warn("Container is not a positioned element. This may cause issues positioning the noose and/or selecting elements."),c.scroll>0&&c.scrollEdge>0?(l.scrollX=("auto"===p.overflowX||"scroll"===p.overflowX)&&s.scrollHeight>s.clientHeight,l.scrollY=("auto"===p.overflowY||"scroll"===p.overflowY)&&s.scrollWidth>s.clientWidth):(l.scrollX=!1,l.scrollY=!1),l.maxScrollY=l.scrollY&&s.scrollHeight-s.clientHeight||0,l.maxScrollX=l.scrollX&&s.scrollWidth-s.clientWidth||0;var f=d.start,v=d.end;if(d.start=null,y.start=null,a.updateContainerPosition().updatePointerPosition(t),c.scrollbar&&(l.scrollX&&d.end.x>l.x+l.w-c.scrollbar||l.scrollY&&d.end.y>l.y+l.h-c.scrollbar))return u=!1,d.start=f,void(d.end=v);if(c.shift&&o&&t.shiftKey&&f){var h=y.top,m=y.bottom,x=Math.floor((f.x+v.x)/2),g=Math.floor((f.y+v.y)/2);y.start={},d.start.x>=x&&d.start.y<g?(d.start.x=r(f.x,v.x),d.start.y=n(f.y,v.y),y.start.x=h.x,y.start.y=m.y):d.start.x<x&&d.start.y<=g?(d.start.x=n(f.x,v.x),d.start.y=n(f.y,v.y),y.start=m):d.start.x<=x&&d.start.y>g?(d.start.x=n(f.x,v.x),d.start.y=r(f.y,v.y),y.start.x=m.x,y.start.y=h.y):d.start.x>x&&d.start.y>=g&&(d.start.x=r(f.x,v.x),d.start.y=r(f.y,v.y),y.start=h)}if(c.ctrl&&o&&t.ctrlKey?a.lastSelection=a.selected||[]:a.lastSelection=[],i.style.display="none",!1===c.start.apply(a,[t,a.coors]))return u=!1,d.start=f,void(d.end=v);s.appendChild(i)}},a._onMove=function(e){if(c.enabled&&u&&e.currentTarget===a.currentTarget){e.cancelable&&e.preventDefault(),"scroll"!==e.type&&a.updatePointerPosition(e),a.updateContainerPosition().updateNoosePosition();var t=a.coors.noose.top,o=a.coors.noose.bottom;i.style.left=t.x,i.style.top=t.y,i.style.width=o.x-t.x,i.style.height=o.y-t.y,i.style.display="block";var r=a.currentTarget,n=a.coors.container,s=a.coors.pointer.end;n.scrollY&&s.y-n.y<c.scrollEdge?r.scrollTop-=c.scroll:n.scrollY&&r.scrollTop<n.maxScrollY&&n.y+n.h-s.y<c.scrollEdge?r.scrollTop+=c.scroll:n.scrollX&&s.x-n.x<c.scrollEdge?r.scrollLeft-=c.scroll:n.scrollX&&r.scrollLeft<n.maxScrollX&&n.x+n.w-s.x<c.scrollEdge&&(r.scrollLeft+=c.scroll),c.compute&&(c.throttle?d||(d=!0,setTimeout((function(){d&&a.compute()&&c.move.apply(a,[e,a.coors,a.selected]),d=!1}),c.throttle)):(a.compute(),c.move.apply(a,[e,a.coors,a.selected])))}},a._onEnd=function(e){a.opts.enabled&&u&&("mouseup"!==e.type||1===e.which)&&(u=!1,e.currentTarget===a.currentTarget&&(a.updateContainerPosition().updatePointerPosition(e).updateNoosePosition(),d=!1,c.compute&&a.compute(!0),setTimeout((function(){c.stop.apply(a,[e,a.coors,a.selected])}),0),a.currentTarget.removeChild(i)))},Array.prototype.forEach.call(a.containers,(function(e){e.addEventListener("mousedown",a._onStart),e.addEventListener("touchstart",a._onStart,!1),e.addEventListener("mousemove",a._onMove),e.addEventListener("touchmove",a._onMove,!1),e.addEventListener("scroll",a._onMove),e.addEventListener("mouseup",a._onEnd),e.addEventListener("touchend",a._onEnd,!1),e.noose=a})),a}return _createClass(o,[{key:"destroy",value:function(){var e=this;return e.containers.forEach((function(t){t.removeEventListener("mousedown",e._onStart),t.removeEventListener("touchstart",e._onStart),t.removeEventListener("mousemove",e._onMove),t.removeEventListener("touchmove",e._onMove),t.removeEventListener("scroll",e._onMove),t.removeEventListener("mouseup",e._onEnd),t.removeEventListener("touchend",e._onEnd),delete t.noose})),e.noose.remove(),e.noose=null,e}},{key:"updateContainerPosition",value:function(){var t=this.coors.container,o=this.currentTarget.getBoundingClientRect();return t.x=o.left+e.pageXOffset,t.y=o.top+e.pageYOffset,t.w=o.width,t.h=o.height,this}},{key:"updatePointerPosition",value:function(e){var t=e&&e.touches&&e.touches[0]||e,o=this.coors.pointer;return t&&"number"==typeof t.pageX&&(o.end={x:t.pageX,y:t.pageY},o.start||(o.start=o.end)),this}},{key:"updateNoosePosition",value:function(){var e=this.currentTarget,t=this.coors.pointer.end,o=this.coors.container,s=this.coors.noose,l=n(t.x-o.x+e.scrollLeft,0),c=n(t.y-o.y+e.scrollTop,0);return s.start||(s.start={x:l,y:c}),s.top={x:r(s.start.x,l),y:r(s.start.y,c)},s.bottom={x:r(n(s.start.x,l),e.scrollWidth),y:r(n(s.start.y,c),e.scrollHeight)},this}},{key:"compute",value:function(){var t=this;if(t.opts.select){var o=t.opts.classes.selected,r=t.currentTarget,n=r.querySelectorAll(t.opts.select),s=t.coors.noose.top,l=t.coors.noose.bottom,c=t.coors.container.x,a=t.coors.container.y;t.selected=[],Array.prototype.forEach.call(n,(function(n){if(n!==t.noose){var i,u=n.getBoundingClientRect(),d=u.left+e.pageXOffset-c+r.scrollLeft,y=u.top+e.pageYOffset-a+r.scrollTop,p=u.width+d,f=u.height+y;i="fit"===t.opts.mode?s.x<=d&&s.y<=y&&l.x>=p&&l.y>=f:!(s.x>p||s.y>f||l.x<d||l.y<y);var v=t.lastSelection.indexOf(n);i&&-1===v||!i&&-1!==v?(o&&n.classList.add(o),t.selected.push(n)):o&&n.classList.remove(o)}}))}return t}}],[{key:"version",get:function(){return"1.2.0"}}]),o}()}),window,document);
//# sourceMappingURL=noose.es5.js.map
